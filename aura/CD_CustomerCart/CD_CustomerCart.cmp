
<aura:component description="CD_CustomerCart" implements="forceCommunity:availableForAllPageTypes, flexipage:availableForAllPageTypes" access="global" controller="CD_CartManagerController">
    <aura:attribute name="customerCartItems" type="Object[]"></aura:attribute>
    <aura:attribute name="meetingDate" type="Datetime"></aura:attribute>
    <aura:attribute name="meetingDatePickerVisible" type="Boolean" default="false"></aura:attribute>
    <aura:attribute name="carIdToSetMeetingDate" type="String"></aura:attribute>
    <aura:handler name="init" value="{! this }" action="{! c.init }"/>

    <lightning:card title="Customer cart" iconName="standard:lead_list" class="slds-tabs_card">
        <lightning:layout horizontalAlign="center" verticalAlign="center" multipleRows='true'>
            <aura:if isTrue="{!v.customerCartItems.length > 0}">
                <table class="slds-table slds-table_bordered slds-table_cell-buffer slds-m-bottom--small">
                    <thead>
                    <tr class="slds-text-title_caps">
                        <th scope="col">
                            <div class="slds-truncate" title="Select">Select</div>
                        </th>
                        <th scope="col">
                            <div class="slds-truncate" title="Name">Name</div>
                        </th>
                        <th scope="col">
                            <div class="slds-truncate" title="Model">Model</div>
                        </th>
                        <th scope="col">
                            <div class="slds-truncate" title="Year">Year</div>
                        </th>
                        <th scope="col">
                            <div class="slds-truncate" title="VIN">VIN</div>
                        </th>
                        <th scope="col">
                            <div class="slds-truncate" title="Price">Price</div>
                        </th>
                        <th scope="col">
                            <div class="slds-truncate" title="Meeting Date">Meeting Date</div>
                        </th>
                        <th scope="col">
                            <div class="slds-truncate" title="Actions">Actions</div>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <aura:iteration items="{!v.customerCartItems}" var="customerCartItem" indexVar="index">
                        <tr>
                            <td data-label="Select">
                                <ui:inputCheckbox value="{!customerCartItem.selected}" click="{!c.xxx}"></ui:inputCheckbox>
                            </td>
                            <td data-label="Name">
                                <lightning:formattedText value="{!customerCartItem.car.Name}"></lightning:formattedText>
                            </td>
                            <td data-label="Model">
                                <lightning:formattedText value="{!customerCartItem.car.CD_Model__c}"></lightning:formattedText>
                            </td>
                            <td data-label="Year">
                                <lightning:formattedDateTime value="{!customerCartItem.car.CD_Year__c}"></lightning:formattedDateTime>
                            </td>
                            <td data-label="VIN">
                                <lightning:formattedText value="{!customerCartItem.car.CD_VIN__c}"></lightning:formattedText>
                            </td>
                            <td data-label="Price">
                                <lightning:formattedNumber value="{!customerCartItem.carLowestPrice.UnitPrice}"></lightning:formattedNumber>
                            </td>
                            <td data-label="Meeting Date">
                                <lightning:formattedDateTime day="2-digit" month="short" year="numeric"  hour="2-digit" minute="2-digit" value="{!customerCartItem.meetingDate}"></lightning:formattedDateTime>
                            </td>
                            <td data-label="Actions">

                                <lightning:buttonMenu iconName="utility:settings" alternativeText="Settings">
                                    <lightning:menuItem label="Go to offer" onactive="{!c.redirectToOffer}" value="{!customerCartItem.car.Id}"/>
                                    <lightning:menuItem label="Set meeting date" onactive="{!c.openSetMeetingDateModal}" value="{!customerCartItem.car.Id}"/>
                                    <lightning:menuItem label="Delete" onactive="{!c.deleteCartItem}" value="{!customerCartItem.car.Id}"/>
                                </lightning:buttonMenu>

                            </td>
                        </tr>
                    </aura:iteration>
                    </tbody>
                </table>
                <lightning:button onclick="{!c.onCheckout}">Checkout</lightning:button>
                <aura:set attribute="else">
                    <lightning:layoutItem class="slds-align_absolute-center" flexibility="auto" padding="around-small">
                        <ui:outputText value="Cart is empty" />
                    </lightning:layoutItem>
                </aura:set>
            </aura:if>
        </lightning:layout>
    </lightning:card>

    <c:CD_Modal aura:id="meetingDatePicker" hasCloseButton="true" title="Set meeting date">
        <aura:if isTrue="{!v.meetingDatePickerVisible}">
            <div class="slds-p-horizontal--small">
                <fieldset class="slds-form--compound">
                    <div class="slds-form-element__group">
                        <div class="slds-form-element__row slds-grid_vertical-align-end">
                            <div class="slds-form-element slds-size--1-of-1">
                                <ui:inputDateTime label="Meeting date" value="{!v.meetingDate}" displayDatePicker="true" required="true"/>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </aura:if>
        <aura:set attribute="footer">
            <lightning:button onclick="{!c.closeSetMeetingDateModal}">Cancel</lightning:button>
            <lightning:button class="slds-button--destructive" onclick="{!c.saveMeetingDate}">Save</lightning:button>
        </aura:set>
    </c:CD_Modal>

    <c:CD_LoadingSpinner aura:id="loadingSpinner"></c:CD_LoadingSpinner>

</aura:component>
